<!DOCTYPE html>
<html lang="en">
<head>

	<meta charset="utf-8" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />

	<title>More adventures with the NAS</title>
	<meta name="HandheldFriendly" content="True" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0" />

	<link rel="stylesheet" type="text/css" href="/assets/css/style.css?v=a17a7e1305" />

	<script>
			var siteUrl = 'https://steadymonkey.eu';
	</script>

	<script>
			var localTheme = localStorage.getItem('attila_theme');
			switch (localTheme) {
					case 'dark':
							document.documentElement.classList.add('theme-dark');
							break;
					case 'light':
							document.documentElement.classList.add('theme-light');
							break;
					default:
							break;
			}
	</script>



			<style>
				.theme-dark:root {
				  --ghost-accent-color: #b6a800;
				}
				@media (prefers-color-scheme: dark) {
				  html:not(.theme-light):root {
				    --ghost-accent-color: #b6a800;
				  }
				}
			</style>

	<meta name="description" content="About ten days ago, I received a scary e-mail from the NAS (it has a name by the way, it&#x27;s called cactus): my boot pool was degraded but still operational. The SSD I added not so long ago to mirror the USB drive actually started to fail." />
    <link rel="canonical" href="https://steadymonkey.eu/more-adventures-with-the-nas/" />
    <meta name="referrer" content="no-referrer-when-downgrade" />
    <link rel="amphtml" href="https://steadymonkey.eu/more-adventures-with-the-nas/amp/" />
    
    <meta property="og:site_name" content="Steady Monkey" />
    <meta property="og:type" content="article" />
    <meta property="og:title" content="More adventures with the NAS" />
    <meta property="og:description" content="About ten days ago, I received a scary e-mail from the NAS (it has a name by the way, it&#x27;s called cactus): my boot pool was degraded but still operational. The SSD I added not so long ago to mirror the USB drive actually started to fail." />
    <meta property="og:url" content="https://steadymonkey.eu/more-adventures-with-the-nas/" />
    <meta property="article:published_time" content="2021-11-17T11:14:29.000Z" />
    <meta property="article:modified_time" content="2021-11-17T11:17:02.000Z" />
    <meta property="article:tag" content="Homelab" />
    
    <meta name="twitter:card" content="summary" />
    <meta name="twitter:title" content="More adventures with the NAS" />
    <meta name="twitter:description" content="About ten days ago, I received a scary e-mail from the NAS (it has a name by the way, it&#x27;s called cactus): my boot pool was degraded but still operational. The SSD I added not so long ago to mirror the USB drive actually started to fail." />
    <meta name="twitter:url" content="https://steadymonkey.eu/more-adventures-with-the-nas/" />
    <meta name="twitter:label1" content="Written by" />
    <meta name="twitter:data1" content="Borjan Tchakaloff" />
    <meta name="twitter:label2" content="Filed under" />
    <meta name="twitter:data2" content="Homelab" />
    
    <script type="application/ld+json">
{
    "@context": "https://schema.org",
    "@type": "Article",
    "publisher": {
        "@type": "Organization",
        "name": "Steady Monkey",
        "url": "https://steadymonkey.eu/",
        "logo": {
            "@type": "ImageObject",
            "url": "https://steadymonkey.eu/favicon.ico"
        }
    },
    "author": {
        "@type": "Person",
        "name": "Borjan Tchakaloff",
        "url": "https://steadymonkey.eu/author/borjan/",
        "sameAs": []
    },
    "headline": "More adventures with the NAS",
    "url": "https://steadymonkey.eu/more-adventures-with-the-nas/",
    "datePublished": "2021-11-17T11:14:29.000Z",
    "dateModified": "2021-11-17T11:17:02.000Z",
    "keywords": "Homelab",
    "description": "About ten days ago, I received a scary e-mail from the NAS (it has a name by the way, it&#x27;s called cactus): my boot pool was degraded but still operational. The SSD I added not so long ago to mirror the USB drive actually started to fail.",
    "mainEntityOfPage": {
        "@type": "WebPage",
        "@id": "https://steadymonkey.eu/"
    }
}
    </script>

    <meta name="generator" content="Ghost 4.48" />
    <link rel="alternate" type="application/rss+xml" title="Steady Monkey" href="https://steadymonkey.eu/rss.xml" />
    
    <script defer src="/public/cards.min.js?v=a17a7e1305"></script>
    <link rel="stylesheet" type="text/css" href="/public/cards.min.css?v=a17a7e1305">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.25.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerpolicy="no-referrer" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.25.0/themes/prism-solarizedlight.min.css" integrity="sha512-fibfhB71IpdEKqLKXP/96WuX1cTMmvZioYp7T6I+lTbvJrrjEGeyYdAf09GHpFptF8toQ32woGZ8bw9+HjZc0A==" crossorigin="anonymous" referrerpolicy="no-referrer" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.25.0/plugins/line-numbers/prism-line-numbers.min.css" integrity="sha512-cbQXwDFK7lj2Fqfkuxbo5iD1dSbLlJGXGpfTDqbggqjHJeyzx88I3rfwjS38WJag/ihH7lzuGlGHpDBymLirZQ==" crossorigin="anonymous" referrerpolicy="no-referrer" />
<link rel="stylesheet" href="https://esm.sh/emfed@1/toots.css" crossorigin="anonymous" referrerpolicy="no-referrer" />
<style>
    :root {--ghost-accent-color: #b6a800;}
    /* Quick hack to reset conflicting styles. */
    .post-content .toots a, .post-content .toots a:hover, .post-content .toots a:focus {
        box-shadow: none;
    }
    .post-content .toots .body a {
        box-shadow: inset 0 -2px 0 var(--ghost-accent-color);
    }
    .post-content .toots .body a:hover,.post-content .toots .body a:focus  {
        box-shadow: inset 0 -3px 0 var(--ghost-accent-color);
    }
</style>
<link rel="me" href="https://freiburg.social/@docbibi" /><style>:root {--ghost-accent-color: #b6a800;}</style>
</head>

<body class="post-template tag-homelab">

	<div class="nav-header">
		<nav class="nav-wrapper" aria-label="Main">
				<ul>
		<li class="nav-home"><a href="https://steadymonkey.eu/"><span>Home</span></a></li>
		<li class="nav-atreus"><a href="https://steadymonkey.eu/tag/atreus/"><span>Atreus</span></a></li>
		<li class="nav-homelab"><a href="https://steadymonkey.eu/tag/homelab/"><span>Homelab</span></a></li>
		<li class="nav-mainboard"><a href="https://steadymonkey.eu/tag/mainboard/"><span>Mainboard</span></a></li>
		<li class="nav-python"><a href="https://steadymonkey.eu/tag/python/"><span>Python</span></a></li>
		<li class="nav-random-bits"><a href="https://steadymonkey.eu/tag/thoughts/"><span>Random bits</span></a></li>
		<li class="nav-services"><a href="https://steadymonkey.eu/services/"><span>Services</span></a></li>
</ul>

				<ul class="nav-meta">
  <li class="nav-search">
    <a title="Search" data-ghost-search>
      <i class="icon icon-search" aria-hidden="true"></i>
      <span>Search</span>
    </a>
  </li>
</ul>
		</nav>

		<div class="nav-wrapper-control">
			<div class="inner">
				<a class="nav-menu" role="button"><i class="icon icon-menu" aria-hidden="true"></i>Menu</a>
				<a class="nav-search" title="Search" role="button" data-ghost-search><i class="icon icon-search" aria-hidden="true"></i></a>
			</div>
		</div>
	</div>
	<div class="nav-close" role="button" aria-label="Close"></div>

	<section class="page-wrapper">

		

<div class="progress-container">
	<span class="progress-bar"></span>
</div>

<header class="post-header ">
	<div class="inner">
		<span class="post-info">
			<span class="post-type">Article</span>
			<span class="post-count">Homelab</span>
		</span>
		<h1 class="post-title">More adventures with the NAS</h1>
		<div class="post-meta">
			<div class="post-meta-avatars">
					<figure class="post-meta-avatar avatar">
					</figure>
			</div>
			<h4 class="post-meta-author"><a href="/author/borjan/">Borjan Tchakaloff</a></h4>
			<time datetime="17-11-2021">17 Nov 2021</time> &bull; 3 min read
		</div>
	</div>
</header>

<main class="content" role="main">
	<article class="post tag-homelab no-image">
		<div class="inner">

			<section class="post-content">
				<p>About ten days ago, I received a scary e-mail from the NAS (it has a name by the way, it's called <em>cactus</em>): my boot pool was degraded but still operational. The SSD I added not so long ago to mirror the USB drive actually started to fail. TrueNAS detected slow read performance, and eventually detached the drive from the pool of its own accord. Smarty pants.</p><p>I was certainly not expecting the SSD to fail before the USB drive (they were roughly as old), especially given that the SSD did not see much wear and that it was stored in an ESD-safe bag together with a desiccant bag.</p><p>I ordered two more SSD drives to replace the current USB drive  and the failed SSD, with the intent of switching to a full SSD mirrored boot pool. I also got a USB-to-SATA converter to connect one of the drives to the internal USB port currently used by the USB drive since I only have access to one internal SATA port (remember, the one for the ODD).</p><p>The plan was simple: connect one SSD first to the SATA port, attach it to the boot pool, let the system resilver the pool, detach the USB stick, power-off, swap the USB stick with the second SSD thanks to the USB-SATA adapter, boot on the first SSD, and do the attach-and-resilver dance once more with the second SSD. It should have been a fairly easy and painless process according to the documentation and online discussions. Except that it was not.</p><p>The first problem I encountered was of a surprising nature. Trying to attach the SSD to the boot pool gave the unhelpful error of "can only attach to mirrors and top-level disks". This is a known UX problem where a few type of errors are aggregated into this high-level exception thrown by TrueNAS' middleware. It is apparently quite common to see this when the block size of the pool and additional disk cannot match. I suspect the initial boot pool was created with a too-small block size (think 512 bytes) while now the recommendation is to go with 4 kilobytes by default. And since the new SSDs have indeed 4k block size, I cannot mix and match them in the existing pool. I did try to make it work for a couple of hours but eventually decided that my mastery level was too low to risk the NAS setup and the time investment needed not worth it. <em>(Not that I would have had the time anyway.)</em></p><p>After reading extensively on how to migrate the TrueNAS boot drive to another medium, I jumped on the fresh install bandwagon. I installed the version I was currently running on the USB stick on the SSD, booted, imported the configuration, and done. It was really simple and it definitely took me longer to read about the procedure (a case of cold feet) than to execute it.</p><p>Now, the idea was to keep a mirror of the boot pool. I wanted to part ways with the USB stick for good and simply use two SSDs. Strangely enough, the second SSD via USB stopped working the moment I installed it inside the NAS. (I did run a couple of tests outside the NAS first, using the external USB ports.) The kernel reported I/O errors and simply backed away from the construct. But only on FreeBSD, I could use the SSD on a GNU/Linux machine without issues.</p><p>This time around, I did not spend too long thinking about the solution: the adapter goes back as DOA and I simply don't mirror the boot pool. <em>Replacing the boot drive is so easy</em> that I am not afraid of the next failure. I have only so much time to debug weird hardware problems. So for now the USB stick remains plugged in, but as a backup boot disk (it is not part of the running boot pool) — that way there is no write on it until the day I need to rescue the system and use it as the boot drive.</p>
			</section>

			<section class="post-footer">

				<aside class="post-tags">
					<span class="post-info-label">Topic</span>
					<a href="/tag/homelab/">Homelab</a>
				</aside>

			</section>




			<aside class="post-nav">

					<a class="post-nav-next" href="/the-cautionary-nightnare/">
						<section class="post-nav-teaser">
							<i class="icon icon-arrow-left" aria-label="Next post"></i>
							<h2 class="post-nav-title">The cautionary nightmare</h2>
							<p class="post-nav-excerpt">I had a dream. Rather, I had a nightmare last night. It&hellip;</p>
							<p class="post-nav-meta"><time datetime="08-12-2021">08 Dec 2021</time></p>
						</section>
					</a>

					<a class="post-nav-prev" href="/upgrading-my-nas-to-truenas-core/">
						<section class="post-nav-teaser">
							<i class="icon icon-arrow-right" aria-label="Previous post"></i>
							<h2 class="post-nav-title">Upgrading my NAS to TrueNAS Core</h2>
							<p class="post-nav-excerpt">Over the course of the week-end, I (finally) upgraded from FreeNAS 11.&hellip;</p>
							<p class="post-nav-meta"><time datetime="24-10-2021">24 Oct 2021</time></p>
						</section>
					</a>
				<div class="clear"></div>
			</aside>

		</div>
	</article>
</main>




		<div class="nav-footer">
			<nav class="nav-wrapper" aria-label="Footer">
				<span class="nav-copy">Steady Monkey &copy; 2024  <a class="nav-rss" title="RSS" href="https://steadymonkey.eu/rss.xml" target="_blank"><i class="icon icon-rss" aria-hidden="true"></i></a></span>
				<ul>
		<li class="nav-docbibi-freiburg-social"><a href="https://freiburg.social/@docbibi"><span>@docbibi@freiburg.social</span></a></li>
		<li class="nav-docbibi-sourcehut"><a href="https://git.sr.ht/~docbibi/"><span>docbibi (SourceHut)</span></a></li>
		<li class="nav-bibz-github"><a href="https://github.com/bibz"><span>bibz (GitHub)</span></a></li>
</ul>

				<span class="nav-credits">Published with <a href="https://ghost.org">Ghost</a> &bull; Theme <a href="https://github.com/zutrinken/attila">Attila</a> &bull; <a class="menu-item js-theme" href="#" data-system="System theme" data-dark="Dark theme" data-light="Light theme"><span class="theme-icon"></span><span class="theme-text">System theme</span> </a> </span>
			</nav>
		</div>

	</section>

	<script type="text/javascript" src="/assets/js/script.js?v=a17a7e1305"></script>

	<script>
  $(document).ready(function () {
		var viewport = $(window);
		var post = $('.post-content');
		// Responsive videos with fitVids
    post.fitVids();
		// Format code blocks and add line numbers
		function codestyling() {
	    $('pre code').each(function(i, e) {
				// Code highlight
	      hljs.highlightElement(e);
	      // No lines for plain text blocks
	      if (!$(this).hasClass('language-text')) {
	        var code = $(this);
					// Calculate amount of lines
	        var lines = code.html().split(/\n(?!$)/g).length;
	        var numbers = [];
	        if (lines > 1) {
	          lines++;
	        }
	        for (i = 1; i < lines; i++) {
	          numbers += '<span class="line" aria-hidden="true">' + i + '</span>';
	        }
	        code.parent().append('<div class="lines">' + numbers + '</div>');
	      }
	    });
	  }
	  codestyling();
		// Reading progress bar on window top
	  function readingProgress() {
			var postBottom = post.offset().top + post.height();
			var viewportHeight = viewport.height();
      var progress = 100 - (((postBottom - (viewport.scrollTop() + viewportHeight) + viewportHeight / 3) / (postBottom - viewportHeight + viewportHeight / 3)) * 100);
      $('.progress-bar').css('width', progress + '%');
      (progress > 100) ? $('.progress-container').addClass('complete'): $('.progress-container').removeClass('complete');
	  }
	  readingProgress();
		// Trigger reading progress
	  viewport.on({
	    'scroll': function() {
	      readingProgress();
	    },
	    'resize': function() {
	      readingProgress();
	    },
	    'orientationchange': function() {
	      readingProgress();
	    }
	  });

  });
</script>


	<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.25.0/prism.min.js" integrity="sha512-hpZ5pDCF2bRCweL5WoA0/N1elet1KYL5mx3LP555Eg/0ZguaHawxNvEjF6O3rufAChs16HVNhEc6blF/rZoowQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.25.0/components/prism-python.min.js" integrity="sha512-yIpe1UXrH/ZWwu3n7MdHNfMbPXftP0jlg9+lRhzlpbolElt33h3PGx9ICzqf/k+yca3QNzqcO3sdtKJuYRTi4g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
<script type="module" src="https://esm.sh/emfed@1" crossorigin="anonymous" referrerpolicy="no-referrer"></script>

</body>
</html>
