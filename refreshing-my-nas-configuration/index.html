<!DOCTYPE html>
<html lang="en">
<head>

	<meta charset="utf-8" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />

	<title>Refreshing my NAS configuration</title>
	<meta name="HandheldFriendly" content="True" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0" />

	<link rel="stylesheet" type="text/css" href="/assets/css/style.css?v=fb080c3fac" />

	<script>
			var siteUrl = 'https://steadymonkey.eu';
	</script>

	<script>
			var localTheme = localStorage.getItem('attila_theme');
			switch (localTheme) {
					case 'dark':
							document.documentElement.classList.add('theme-dark');
							break;
					case 'light':
							document.documentElement.classList.add('theme-light');
							break;
					default:
							break;
			}
	</script>

	<link rel="canonical" href="https://steadymonkey.eu/refreshing-my-nas-configuration/" />
    <meta name="referrer" content="no-referrer-when-downgrade" />
    <link rel="amphtml" href="https://steadymonkey.eu/refreshing-my-nas-configuration/amp/" />
    
    <meta property="og:site_name" content="Steady Monkey" />
    <meta property="og:type" content="article" />
    <meta property="og:title" content="Refreshing my NAS configuration" />
    <meta property="og:description" content="I setup my Network Attached Storage (NAS) back in 2014 after getting a nice discount on a HP MicroServer of the previous generation. I added some more ECC RAM, fitted four hard drives, installed FreeNAS, and then happily used it to offload my poor computers of all the media and" />
    <meta property="og:url" content="https://steadymonkey.eu/refreshing-my-nas-configuration/" />
    <meta property="article:published_time" content="2021-08-28T20:47:14.000Z" />
    <meta property="article:modified_time" content="2021-10-24T15:32:05.000Z" />
    <meta property="article:tag" content="Homelab" />
    
    <meta name="twitter:card" content="summary" />
    <meta name="twitter:title" content="Refreshing my NAS configuration" />
    <meta name="twitter:description" content="I setup my Network Attached Storage (NAS) back in 2014 after getting a nice discount on a HP MicroServer of the previous generation. I added some more ECC RAM, fitted four hard drives, installed FreeNAS, and then happily used it to offload my poor computers of all the media and" />
    <meta name="twitter:url" content="https://steadymonkey.eu/refreshing-my-nas-configuration/" />
    <meta name="twitter:label1" content="Written by" />
    <meta name="twitter:data1" content="Borjan Tchakaloff" />
    <meta name="twitter:label2" content="Filed under" />
    <meta name="twitter:data2" content="Homelab" />
    
    <script type="application/ld+json">
{
    "@context": "https://schema.org",
    "@type": "Article",
    "publisher": {
        "@type": "Organization",
        "name": "Steady Monkey",
        "url": "https://steadymonkey.eu/",
        "logo": {
            "@type": "ImageObject",
            "url": "https://steadymonkey.eu/favicon.ico"
        }
    },
    "author": {
        "@type": "Person",
        "name": "Borjan Tchakaloff",
        "url": "https://steadymonkey.eu/author/borjan/",
        "sameAs": []
    },
    "headline": "Refreshing my NAS configuration",
    "url": "https://steadymonkey.eu/refreshing-my-nas-configuration/",
    "datePublished": "2021-08-28T20:47:14.000Z",
    "dateModified": "2021-10-24T15:32:05.000Z",
    "keywords": "Homelab",
    "description": "I setup my Network Attached Storage (NAS) back in 2014 after getting a nice\ndiscount on a HP MicroServer of the previous generation. I added some more ECC\nRAM, fitted four hard drives, installed FreeNAS, and then happily used it to\noffload my poor computers of all the media and random stuff I had lying around\nthere. When I moved out of the country in 2015, I packed light and left the NAS\nbehind. Until 2021.\n\nThe 2TB hard drives are not so big by today&#x27;s standards but I am happy with the\n3.4TB to",
    "mainEntityOfPage": {
        "@type": "WebPage",
        "@id": "https://steadymonkey.eu/"
    }
}
    </script>

    <meta name="generator" content="Ghost 4.48" />
    <link rel="alternate" type="application/rss+xml" title="Steady Monkey" href="https://steadymonkey.eu/rss.xml" />
    
    <script defer src="/public/cards.min.js?v=fb080c3fac"></script>
    <link rel="stylesheet" type="text/css" href="/public/cards.min.css?v=fb080c3fac">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.25.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerpolicy="no-referrer" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.25.0/themes/prism-solarizedlight.min.css" integrity="sha512-fibfhB71IpdEKqLKXP/96WuX1cTMmvZioYp7T6I+lTbvJrrjEGeyYdAf09GHpFptF8toQ32woGZ8bw9+HjZc0A==" crossorigin="anonymous" referrerpolicy="no-referrer" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.25.0/plugins/line-numbers/prism-line-numbers.min.css" integrity="sha512-cbQXwDFK7lj2Fqfkuxbo5iD1dSbLlJGXGpfTDqbggqjHJeyzx88I3rfwjS38WJag/ihH7lzuGlGHpDBymLirZQ==" crossorigin="anonymous" referrerpolicy="no-referrer" />
<link rel="stylesheet" href="https://esm.sh/emfed@1/toots.css" crossorigin="anonymous" referrerpolicy="no-referrer" />
<style>
    :root {--ghost-accent-color: #b6a800;}
    /* Quick hack to reset conflicting styles. */
    .post-content .toots a, .post-content .toots a:hover, .post-content .toots a:focus {
        box-shadow: none;
    }
    .post-content .toots .body a {
        box-shadow: inset 0 -2px 0 var(--ghost-accent-color);
    }
    .post-content .toots .body a:hover,.post-content .toots .body a:focus  {
        box-shadow: inset 0 -3px 0 var(--ghost-accent-color);
    }
</style>
<link rel="me" href="https://freiburg.social/@docbibi" /><style>:root {--ghost-accent-color: #b6a800;}</style>
</head>

<body class="post-template tag-homelab">

	<div class="nav-header">
		<nav class="nav-wrapper" aria-label="Main">
				<ul>
		<li class="nav-home"><a href="https://steadymonkey.eu/"><span>Home</span></a></li>
		<li class="nav-atreus"><a href="https://steadymonkey.eu/tag/atreus/"><span>Atreus</span></a></li>
		<li class="nav-homelab"><a href="https://steadymonkey.eu/tag/homelab/"><span>Homelab</span></a></li>
		<li class="nav-mainboard"><a href="https://steadymonkey.eu/tag/mainboard/"><span>Mainboard</span></a></li>
		<li class="nav-python"><a href="https://steadymonkey.eu/tag/python/"><span>Python</span></a></li>
		<li class="nav-random-bits"><a href="https://steadymonkey.eu/tag/thoughts/"><span>Random bits</span></a></li>
		<li class="nav-services"><a href="https://steadymonkey.eu/services/"><span>Services</span></a></li>
</ul>

				<ul class="nav-meta">
  <li class="nav-search" style="display: none;">
    <a title="Search">
      <i class="icon icon-search" aria-hidden="true"></i>
      <span>Search</span>
    </a>
  </li>
  <!--
    <li class="nav-subscribe">
      <a href="#/portal">Subscribe</a>
    </li>
  -->
</ul>
		</nav>

		<div class="nav-wrapper-control">
			<div class="inner">
				<a class="nav-menu" role="button"><i class="icon icon-menu" aria-hidden="true"></i>Menu</a>
				<a class="nav-search" style="display: none;" title="Search" role="button"><i class="icon icon-search" aria-hidden="true"></i></a>
			</div>
		</div>
	</div>
	<div class="nav-close" role="button" aria-label="Close"></div>

	<section class="page-wrapper">

		

<div class="progress-container">
	<span class="progress-bar"></span>
</div>

<header class="post-header ">
	<div class="inner">
		<span class="post-info">
			<span class="post-type">Article</span>
			<span class="post-count">Homelab</span>
		</span>
		<h1 class="post-title">Refreshing my NAS configuration</h1>
		<div class="post-meta">
			<div class="post-meta-avatars">
					<figure class="post-meta-avatar avatar">
					</figure>
			</div>
			<h4 class="post-meta-author"><a href="/author/borjan/">Borjan Tchakaloff</a></h4>
			<time datetime="28-08-2021">28 Aug 2021</time> &bull; 3 min read
		</div>
	</div>
</header>

<main class="content" role="main">
	<article class="post tag-homelab no-image">
		<div class="inner">

			<section class="post-content">
				<p>I setup my Network Attached Storage (NAS) back in 2014 after getting a nice discount on a HP MicroServer of the previous generation. I added some more ECC RAM, fitted four hard drives, installed FreeNAS, and then happily used it to offload my poor computers of all the media and random stuff I had lying around there. When I moved out of the country in 2015, I packed light and left the NAS behind. Until 2021.</p><p>The 2TB hard drives are not so big by today's standards but I am happy with the 3.4TB total storage space for now (the hard drives are setup in a RAID-Z2 array, allowing me to lose two drives out of four). Of course if I lose a drive, chances are the others will fail soon too. Maybe even during the resilvering (rebuilding the RAID after replacing the faulty drive). <em>A RAID array is not a backup.</em> I read multiple times that 6 drives would give the best trade-off with RAID-Z2, but unless I fit two more 3.5" hard drives in that small space (it's not hot in there, but the fans and drives are too loud already), it's not going to happen any time soon.</p><p>I did a few routine maintenance updates of FreeNAS itself, but I am still lagging behind on an unsupported version. The latest version is not even called FreeNAS anymore, it's <a href="https://www.truenas.com/truenas-core/">TrueNAS CORE</a> now. Though I have to say that after the initial setup, I simply forgot about it and simply used the NFS shares for a bit. It just worked.</p><p>When I configured FreeNAS in 2014, I had no idea about how many datasets I should create and how I should split my data. I simply went with <em>documents</em> (to store my home dirs), <em>media</em> (music, movies, and the like), and <em>raw</em> (everything else that was not nicely sorted such as mirrors of external drives and copies of old (internal) drives before disposing of the hosts).</p><p>I won't lie, I am still a neophyte when it comes to handling FreeBSD (e.g. the jails) and configuring it. Last week I managed to mess up all file permissions of one of my datasets. Thankfully it was my home dirs mirror, so it does not matter if I blindly reset the permissions to <code>u+rwX,go=</code>. I also realised that I was naive enough to store my NAS user account on that same dataset. So when I reset the permissions, I also set the wrong bits for the SSH configuration and could not login anymore. It took me a shamefully long time to realise why I could not remotely log-in. I finally solved my problem with the help of the console in the FreeNAS UI: one call to <code>chmod</code> later and I could log-in again.</p><p>Here is the new scheme I came up with:</p><ul><li><code>home</code>: simply the home directories of the NAS accounts; I don't want to stupidly break my SSH configuration anymore</li><li><code>dione</code>, <code>iapetus</code>, …: mirrors of the data stored on my everyday computers</li><li><code>media</code>: original dataset for multimedia files – still a good idea</li><li><code>raw</code>: original staging dataset of files I am supposed to review and categorise – only relevant if I <em>actually</em> move things out of it, otherwise I should rename it to <code>dumpster</code></li></ul><p>The idea of mirroring data from my computers is that I can leverage ZFS snapshots directly on the NAS and not handle a more-or-less complicated, and more-or-less very slow incremental local backup process. I do not work with really big files on my computers. The only time I access big multimedia files is when I travel and I want a local cache of movies/series. I am fine <code>rsync</code>-ing a subset of my filesystem over the wire to the NAS every day.</p><p>I thought that it would be really nice to be able to browse through the snapshots in a user-friendly manner, for instance if I want to restore an older version of a file. After a few days of leaving that train of thoughts on the back-burner, I came to the conclusion that I actually do not need that feature. I don't care about selective restoration. I don't need a time machine for individual files because if I do, then I use a version control system (e.g. Git). I imagine that the only times I would need to restore a snapshot are if I have a hardware failure, and if my files end up encrypted by some external entity asking me to pay them in cryptocurrency in exchange for the decryption key. In both cases I can take the time to navigate through manually cloning the snapshots in question and promoting it or restoring from it.</p><p>Next up: switching from <code>DéjàDup</code> against Google Drive to <code>rsync</code> to the NAS.</p>
			</section>

			<section class="post-footer">

				<div class="post-share">
					<span class="post-info-label">Share</span>
					<a title="Twitter" aria-label="Twitter" class="twitter" href="https://twitter.com/share?text=Refreshing my NAS configuration&url=https://steadymonkey.eu/refreshing-my-nas-configuration/" onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">
						<i class="icon icon-twitter" aria-hidden="true"></i>
					</a>
					<a title="Facebook" aria-label="Facebook" class="facebook" href="https://www.facebook.com/sharer/sharer.php?u=https://steadymonkey.eu/refreshing-my-nas-configuration/" onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;">
						<i class="icon icon-facebook" aria-hidden="true"></i>
					</a>
					<a title="LinkedIn" aria-label="LinkedIn" class="linkedin" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https://steadymonkey.eu/refreshing-my-nas-configuration//&amp;title=Refreshing my NAS configuration" onclick="window.open(this.href, 'linkedin-share', 'width=930,height=720');return false;">
						<i class="icon icon-linkedin" aria-hidden="true"></i>
					</a>
					<a title="Email" aria-label="Email" class="email" href="mailto:?subject=Refreshing my NAS configuration&amp;body=https://steadymonkey.eu/refreshing-my-nas-configuration/">
						<i class="icon icon-mail" aria-hidden="true"></i>
					</a>
				</div>

				<aside class="post-tags">
					<span class="post-info-label">Topic</span>
					<a href="/tag/homelab/">Homelab</a>
				</aside>

			</section>


			<section class="post-comments">
				<a id="show-disqus" class="post-comments-activate">Show Comments</a>
			   <div id="disqus_thread"></div>
			</section>


			<aside class="post-nav">

					<a class="post-nav-next" href="/upgrading-my-nas-to-truenas-core/">
						<section class="post-nav-teaser">
							<i class="icon icon-arrow-left" aria-label="Next post"></i>
							<h2 class="post-nav-title">Upgrading my NAS to TrueNAS Core</h2>
							<p class="post-nav-excerpt">Over the course of the week-end, I (finally) upgraded from FreeNAS 11.&hellip;</p>
							<p class="post-nav-meta"><time datetime="24-10-2021">24 Oct 2021</time></p>
						</section>
					</a>

					<a class="post-nav-prev" href="/atreus-build-part-5/">
						<section class="post-nav-teaser">
							<i class="icon icon-arrow-right" aria-label="Previous post"></i>
							<h2 class="post-nav-title">Atreus build part 5: Adding external access to the reset pin</h2>
							<p class="post-nav-excerpt">This post belongs to the Atreus build series, which was introduced by&hellip;</p>
							<p class="post-nav-meta"><time datetime="24-06-2020">24 Jun 2020</time></p>
						</section>
					</a>
				<div class="clear"></div>
			</aside>

		</div>
	</article>
</main>





		<div class="search-wrapper">
			<div class="search">
		    <form class="search-form">
          <input class="search-field" type="text" placeholder="Search …">
          <button class="search-button" type="submit">
						<i class="icon icon-search" aria-hidden="true"></i>
					</button>
		    </form>
				<div class="popular-wrapper">
					<h4 class="popular-title">Topics</h4>
					<span class="popular-tags post-tags">
								<a href='/tag/atreus/'>Atreus: 6</a>
								<a href='/tag/homelab/'>Homelab: 4</a>
								<a href='/tag/thoughts/'>Thoughts: 3</a>
								<a href='/tag/mainboard/'>Mainboard: 3</a>
								<a href='/tag/python/'>Python: 1</a>
								<a href='/tag/domaindrivendesign/'>DomainDrivenDesign: 1</a>
					</span>
				</div>
				<div class="search-result"></div>
			</div>
			<button class="search-wrapper-close" aria-label="Close"></button>
		</div>

		<div class="nav-footer">
			<nav class="nav-wrapper" aria-label="Footer">
				<span class="nav-copy">Steady Monkey &copy; 2024  <a class="nav-rss" title="RSS" href="https://steadymonkey.eu/rss.xml" target="_blank"><i class="icon icon-rss" aria-hidden="true"></i></a></span>
				<ul>
		<li class="nav-docbibi-freiburg-social"><a href="https://freiburg.social/@docbibi"><span>@docbibi@freiburg.social</span></a></li>
		<li class="nav-docbibi-sourcehut"><a href="https://git.sr.ht/~docbibi/"><span>docbibi (SourceHut)</span></a></li>
		<li class="nav-bibz-github"><a href="https://github.com/bibz"><span>bibz (GitHub)</span></a></li>
</ul>

				<span class="nav-credits">Published with <a href="https://ghost.org">Ghost</a> &bull; Theme <a href="https://github.com/zutrinken/attila">Attila</a> &bull; <a class="menu-item js-theme" href="#" data-system="System theme" data-dark="Dark theme" data-light="Light theme"><span class="theme-icon"></span><span class="theme-text">System theme</span> </a> </span>
			</nav>
		</div>

	</section>

	<script type="text/javascript" src="/assets/js/script.js?v=fb080c3fac"></script>

	<script>
  $(document).ready(function () {
		var viewport = $(window);
		var post = $('.post-content');
		// Responsive videos with fitVids
    post.fitVids();
		// Format code blocks and add line numbers
		function codestyling() {
	    $('pre code').each(function(i, e) {
				// Code highlight
	      hljs.highlightBlock(e);
	      // No lines for plain text blocks
	      if (!$(this).hasClass('language-text')) {
	        var code = $(this);
					// Calculate amount of lines
	        var lines = code.html().split(/\n(?!$)/g).length;
	        var numbers = [];
	        if (lines > 1) {
	          lines++;
	        }
	        for (i = 1; i < lines; i++) {
	          numbers += '<span class="line" aria-hidden="true">' + i + '</span>';
	        }
	        code.parent().append('<div class="lines">' + numbers + '</div>');
	      }
	    });
	  }
	  codestyling();
		// Reading progress bar on window top
	  function readingProgress() {
			var postBottom = post.offset().top + post.height();
			var viewportHeight = viewport.height();
      var progress = 100 - (((postBottom - (viewport.scrollTop() + viewportHeight) + viewportHeight / 3) / (postBottom - viewportHeight + viewportHeight / 3)) * 100);
      $('.progress-bar').css('width', progress + '%');
      (progress > 100) ? $('.progress-container').addClass('complete'): $('.progress-container').removeClass('complete');
	  }
	  readingProgress();
		// Trigger reading progress
	  viewport.on({
	    'scroll': function() {
	      readingProgress();
	    },
	    'resize': function() {
	      readingProgress();
	    },
	    'orientationchange': function() {
	      readingProgress();
	    }
	  });
		// Check if disqus is defined by code injection
		if (typeof disqus === 'undefined') {
			// hide comment section
	    $('.post-comments').css({
	      'display': 'none'
	    });
	  } else {
	    $('#show-disqus').on('click', function() {
	      $.ajax({
	        type: "GET",
	        url: "//" + disqus + ".disqus.com/embed.js",
	        dataType: "script",
	        cache: true
	      });
	      $(this).parent().addClass('activated');
	    });
	  }
  });
</script>


	<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.25.0/prism.min.js" integrity="sha512-hpZ5pDCF2bRCweL5WoA0/N1elet1KYL5mx3LP555Eg/0ZguaHawxNvEjF6O3rufAChs16HVNhEc6blF/rZoowQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.25.0/components/prism-python.min.js" integrity="sha512-yIpe1UXrH/ZWwu3n7MdHNfMbPXftP0jlg9+lRhzlpbolElt33h3PGx9ICzqf/k+yca3QNzqcO3sdtKJuYRTi4g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
<script type="module" src="https://esm.sh/emfed@1" crossorigin="anonymous" referrerpolicy="no-referrer"></script>

</body>
</html>
