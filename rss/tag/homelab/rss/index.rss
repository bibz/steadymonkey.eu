<!DOCTYPE html>
<html><rss xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:content="http://purl.org/rss/1.0/modules/content/" xmlns:atom="http://www.w3.org/2005/Atom" xmlns:media="http://search.yahoo.com/mrss/" version="2.0"><channel><title>Homelab - Steady Monkey</title><description>Whatever thoughts out of Borjan's head.</description><link>http://localhost:3050/</link><image><url>http://localhost:3050/favicon.png</url><title>Homelab - Steady Monkey</title><link>http://localhost:3050/</link></image><generator>Ghost 4.19</generator><lastBuildDate>Sun, 24 Oct 2021 20:33:15 GMT</lastBuildDate><atom:link href="http://localhost:3050/tag/homelab/rss/" rel="self" type="application/rss+xml"/><ttl>60</ttl><item><title>Upgrading my NAS to TrueNAS Core</title><description>&lt;p&gt;Over the course of the week-end, I (finally) upgraded from FreeNAS 11.3 to TrueNAS Core 12.0.&lt;/p&gt;&lt;p&gt;One of the most notable things with the new version is that it is strongly discouraged to use a USB stick as boot drive. Since my NAS has an internal USB port&lt;/p&gt;</description><link>http://localhost:3050/upgrading-my-nas-to-truenas-core/</link><guid isPermaLink="false">6175c0545908100001910bab</guid><category>Homelab</category><dc:creator>Borjan Tchakaloff</dc:creator><pubDate>Sun, 24 Oct 2021 19:23:26 GMT</pubDate><content:encoded>&lt;p&gt;Over the course of the week-end, I (finally) upgraded from FreeNAS 11.3 to TrueNAS Core 12.0.&lt;/p&gt;&lt;p&gt;One of the most notable things with the new version is that it is strongly discouraged to use a USB stick as boot drive. Since my NAS has an internal USB port for a boot stick, it is of course what I have been using since the beginning: a very small SanDisk Cruzer Fit of 16GB. Good opportunity to use that old (but unused) Intel SSD of 40GB that has been forgotten in the unnamed box of electronics.&lt;/p&gt;&lt;p&gt;My initial thought was to unplug everything from the motherboard, the data hard drives, the boot USB stick, the ethernet cable, and install TrueNAS on the SSD. Not only is that a bit on the paranoid side, it is also completely unnecessary. It turns out plugging in the SSD and adding it to the ZFS boot pool was enough to seamlessly upgrade my boot storage to a two-disk mirror. As a side-effect, my boot pool is limited by the smaller disk but I now have a &lt;em&gt;mirrored&lt;/em&gt; boot pool. Yay for redundancy. 16GB is enough for now anyway, the main disk space use is on OS upgrade to create a new boot environment. That does not happen so often to me (sic).&lt;/p&gt;&lt;p&gt;It is worth noting that the NAS do have a fifth SATA port, for the optional ODD (Optical Disk Drive). I decided to flash the BIOS with a well-known community mod to allow disabling the IDE mode on this fifth port, thus allowing the full SATA-3Gbps bandwidth.&lt;/p&gt;&lt;p&gt;If the USB stick comes to fail, I will still be able to boot the NAS from the SSD (which is the boot drive anyway). When that happens, I might get a USB-to-SATA adapter and fit another small SSD somewhere in the NAS enclosure to keep the mirrored boot pool.&lt;/p&gt;&lt;p&gt;Back to the upgrade: booting off a USB stick with TrueNAS Core 12.0 and selecting the &amp;quot;upgrade&amp;quot; process went as smooth as can be expected. And&amp;#x2026; that&amp;apos;s it, the NAS is up-to-date now. I am still impressed by how little maintenance is actually needed for FreeNAS/TrueNAS. Setting things up do take some time, though.&lt;/p&gt;</content:encoded></item><item><title>Refreshing my NAS configuration</title><description>&lt;p&gt;I setup my Network Attached Storage (NAS) back in 2014 after getting a nice discount on a HP MicroServer of the previous generation. I added some more ECC RAM, fitted four hard drives, installed FreeNAS, and then happily used it to offload my poor computers of all the media and&lt;/p&gt;</description><link>http://localhost:3050/refreshing-my-nas-configuration/</link><guid isPermaLink="false">6175c0545908100001910baa</guid><category>Homelab</category><dc:creator>Borjan Tchakaloff</dc:creator><pubDate>Sat, 28 Aug 2021 20:47:14 GMT</pubDate><content:encoded>&lt;p&gt;I setup my Network Attached Storage (NAS) back in 2014 after getting a nice discount on a HP MicroServer of the previous generation. I added some more ECC RAM, fitted four hard drives, installed FreeNAS, and then happily used it to offload my poor computers of all the media and random stuff I had lying around there. When I moved out of the country in 2015, I packed light and left the NAS behind. Until 2021.&lt;/p&gt;&lt;p&gt;The 2TB hard drives are not so big by today&amp;apos;s standards but I am happy with the 3.4TB total storage space for now (the hard drives are setup in a RAID-Z2 array, allowing me to lose two drives out of four). Of course if I lose a drive, chances are the others will fail soon too. Maybe even during the resilvering (rebuilding the RAID after replacing the faulty drive). &lt;em&gt;A RAID array is not a backup.&lt;/em&gt; I read multiple times that 6 drives would give the best trade-off with RAID-Z2, but unless I fit two more 3.5&amp;quot; hard drives in that small space (it&amp;apos;s not hot in there, but the fans and drives are too loud already), it&amp;apos;s not going to happen any time soon.&lt;/p&gt;&lt;p&gt;I did a few routine maintenance updates of FreeNAS itself, but I am still lagging behind on an unsupported version. The latest version is not even called FreeNAS anymore, it&amp;apos;s &lt;a href="https://www.truenas.com/truenas-core/"&gt;TrueNAS CORE&lt;/a&gt; now. Though I have to say that after the initial setup, I simply forgot about it and simply used the NFS shares for a bit. It just worked.&lt;/p&gt;&lt;p&gt;When I configured FreeNAS in 2014, I had no idea about how many datasets I should create and how I should split my data. I simply went with &lt;em&gt;documents&lt;/em&gt; (to store my home dirs), &lt;em&gt;media&lt;/em&gt; (music, movies, and the like), and &lt;em&gt;raw&lt;/em&gt; (everything else that was not nicely sorted such as mirrors of external drives and copies of old (internal) drives before disposing of the hosts).&lt;/p&gt;&lt;p&gt;I won&amp;apos;t lie, I am still a neophyte when it comes to handling FreeBSD (e.g. the jails) and configuring it. Last week I managed to mess up all file permissions of one of my datasets. Thankfully it was my home dirs mirror, so it does not matter if I blindly reset the permissions to &lt;code&gt;u+rwX,go=&lt;/code&gt;. I also realised that I was naive enough to store my NAS user account on that same dataset. So when I reset the permissions, I also set the wrong bits for the SSH configuration and could not login anymore. It took me a shamefully long time to realise why I could not remotely log-in. I finally solved my problem with the help of the console in the FreeNAS UI: one call to &lt;code&gt;chmod&lt;/code&gt; later and I could log-in again.&lt;/p&gt;&lt;p&gt;Here is the new scheme I came up with:&lt;/p&gt;&lt;ul&gt;&lt;li&gt;&lt;code&gt;home&lt;/code&gt;: simply the home directories of the NAS accounts; I don&amp;apos;t want to stupidly break my SSH configuration anymore&lt;/li&gt;&lt;li&gt;&lt;code&gt;dione&lt;/code&gt;, &lt;code&gt;iapetus&lt;/code&gt;, &amp;#x2026;: mirrors of the data stored on my everyday computers&lt;/li&gt;&lt;li&gt;&lt;code&gt;media&lt;/code&gt;: original dataset for multimedia files &amp;#x2013; still a good idea&lt;/li&gt;&lt;li&gt;&lt;code&gt;raw&lt;/code&gt;: original staging dataset of files I am supposed to review and categorise &amp;#x2013; only relevant if I &lt;em&gt;actually&lt;/em&gt; move things out of it, otherwise I should rename it to &lt;code&gt;dumpster&lt;/code&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;The idea of mirroring data from my computers is that I can leverage ZFS snapshots directly on the NAS and not handle a more-or-less complicated, and more-or-less very slow incremental local backup process. I do not work with really big files on my computers. The only time I access big multimedia files is when I travel and I want a local cache of movies/series. I am fine &lt;code&gt;rsync&lt;/code&gt;-ing a subset of my filesystem over the wire to the NAS every day.&lt;/p&gt;&lt;p&gt;I thought that it would be really nice to be able to browse through the snapshots in a user-friendly manner, for instance if I want to restore an older version of a file. After a few days of leaving that train of thoughts on the back-burner, I came to the conclusion that I actually do not need that feature. I don&amp;apos;t care about selective restoration. I don&amp;apos;t need a time machine for individual files because if I do, then I use a version control system (e.g. Git). I imagine that the only times I would need to restore a snapshot are if I have a hardware failure, and if my files end up encrypted by some external entity asking me to pay them in cryptocurrency in exchange for the decryption key. In both cases I can take the time to navigate through manually cloning the snapshots in question and promoting it or restoring from it.&lt;/p&gt;&lt;p&gt;Next up: switching from &lt;code&gt;D&amp;#xE9;j&amp;#xE0;Dup&lt;/code&gt; against Google Drive to &lt;code&gt;rsync&lt;/code&gt; to the NAS.&lt;/p&gt;</content:encoded></item></channel></rss></html>